# Metabase Reports
The objective of this project is to get information from the API of a [metabase](https://metabase.com/) instance and display it in a formatted report file.

## Setting up your environment

### With [Virtualenv](https://virtualenv.pypa.io/) (recommended)

#### How to use virtualenv:

* Creating a python environment: 
    * `virtualenv env`
    * env is the name of the folder where your environment will be stored
* Activating your environment:
    * `source ./env/bin/activate`
* Deactivating your environment:
    * `deactivate`
* For more information about how to use Virtualenv visit the [official documentation](https://virtualenv.pypa.io/en/latest/)


#### Steps to set up your environment using virtualenv:

* Install python 3.X.Y

* Install pip (python3-pip)

* Install virtualenv (``python3 -m pip install virtualenv``)

* Change your current folder to the root directory of the project run in the terminal

* Create your python environment

* Activate your environment

* Install the required python modules: `pip install -r requirements.txt`

* (Optional) Deactivate your environment

* Note: Using this method, you have to make sure you have activated the virtualenv environment before running the metabase reports program

### Without Virtualenv

* Install python 3.X.Y

* Install pip (python3-pip)

* Install virtualenv (``python3 -m pip install virtualenv``)

* Install the required python modules: `pip3 install -r requirements.txt`


## How to Use

* Before running the program the first time you have open the configuration files named **config.json** and **login_info.json** and fill the correct information in the *api_url*, *username* and *password* fields.
* The configuration files are described properly in the Configuration Files section.
* After that, you simply have to execute `python3 ./metabase_reports.py` to run the program.

### Usage

```
usage: metabase_reports.py [-h]
                           [--print_collections | --print_cards [ARGS [ARGS ...]]
                           | --create_pdf_report [ARGS [ARGS ...]]]
                           [-A API_URL]

Metabase Interface program

optional arguments:
  -h, --help            show this help message and exit
  --print_collections   list available metabase collections
  --print_cards [ARGS [ARGS ...]]
                        list metabase cards in specified collection(s)
  --create_pdf_report [ARGS [ARGS ...]]
                        print specified collection(s) or cards to a pdf file
  -A API_URL, --api_url API_URL
                        define api url
```

* The arguments expected by functions in the CLI are the same arguments that may be passed using the **arguments.json** file, as described in the next section.

### Configuration Files

All the configuration files are in the [json](https://www.json.org/) format.

* #### login_info.json

    * The login_info.json file is **required** to use the metabase API.
    * In this file you have to provide a valid *username* and *password* combination for the metabase instance.
    * Example:
```
{
    "username": "username_or_email_here",
    "password": "password_here"
}
```

* #### config.json

    * The config.json file is where the base configuration of the program is stored.
    * The *api_url* is used to specify the api url of a metabase instance.
    * The *api_url* field is **required**, **if** you don't provide a valid api url as an argument in the CLI using the -A option.
    * Example:
```
{
    "api_url": "http://metabase.mydomain.com/api/"
}
```

* #### arguments.json

    * The arguments.json is an *optional* configuration file where the arguments for a function of the program may be passed, instead of passing them as arguments in the CLI.
    * The *print_cards* function expects an array that contains the ids of collections.
    * The *create_pdf_report* function expects an array that contains either the ids of collections or json objects that contains the collection id.
    * In the *create_pdf_report* function you may specify which cards should be used in the report in case you are using the json object as an argument.
    * Example:
```
{
    "print_cards": [3, 2],
    "create_pdf_report": [
        1,
        {"collection": 2, "cards": [5]},
        {"collection": 3}
    ]
}
```

* #### credentials.json

    * The credentials.json file is where the id of your credentials and its expiration date are stored.
    * **Do not edit this file**.
    * Example:
```
{
    "id": "0e9x8afm6pblced4621d373cade4e832627b4f6",
    "expire_date": "2019-04-25"
}
```

## Project structure
```
metabase-reports/
├── arguments.json
├── config.json
├── credentials.json
├── login_info.json
├── metabaseapi
│   ├── __init__.py
│   └── metabaseapi.py
├── metabase_reports.py
├── pdfreport
│   ├── __init__.py
│   └── pdfreport.py
├── README.md
└── requirements.txt

4 directories, 16 files
```
